{% if notifications and notifications|length > 0 %}
<table class="table table-striped table-hover" style="text-align: center;">
    <thead>
        <tr>
            <th>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="selectAllCheckbox">
                </div>
            </th>
            <th>ID</th>
            <th>标题</th>
            <th>内容</th>
            <th>类型</th>
            <th>优先级</th>
            <th>状态</th>
            <th>创建时间</th>
            <th>阅读时间</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody>
        {% for notification in notifications %}
        <tr class="notification-row" data-id="{{ notification.id }}">
            <td>
                <div class="form-check">
                    <input class="form-check-input notification-checkbox" type="checkbox" value="{{ notification.id }}">
                </div>
            </td>
            <td>{{ notification.id }}</td>
            <td>{{ notification.title }}</td>
            <td class="notification-content">{{ notification.content }}</td>
            <td>{{ notification.type }}</td>
            <td class="priority-{{ notification.priority }}">{{ notification.priority }}</td>
            <td class="notification-status">
                <span class="{% if notification.status == '未读' %}status-unread{% else %}status-read{% endif %}">{{ notification.status }}</span>
            </td>
            <td>{{ notification.created_at }}</td>
            <td>{{ notification.read_at or '未读' }}</td>
            <td class="action-buttons">
                <button class="btn btn-sm btn-info view-notification-btn" 
                        data-id="{{ notification.id }}"
                        data-title="{{ notification.title }}"
                        data-content="{{ notification.content }}"
                        data-type="{{ notification.type }}"
                        data-priority="{{ notification.priority }}"
                        data-status="{{ notification.status }}"
                        data-created-at="{{ notification.created_at }}"
                        data-read-at="{{ notification.read_at or '' }}"
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="查看详情">
                    <i class="bi bi-info-circle"></i>
                </button>
                {% if notification.status == '未读' %}
                <button class="btn btn-sm btn-success mark-read-btn" 
                        data-id="{{ notification.id }}" 
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="标记为已读">
                    <i class="bi bi-check-circle"></i>
                </button>
                {% else %}
                <button class="btn btn-sm btn-success mark-read-btn" 
                        data-id="{{ notification.id }}" 
                        disabled 
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="已读">
                    <i class="bi bi-check-circle-fill"></i>
                </button>
                {% endif %}
                <button class="btn btn-sm btn-danger delete-notification-btn" 
                        data-id="{{ notification.id }}" 
                        data-title="{{ notification.title }}"
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="删除通知">
                    <i class="bi bi-trash"></i>
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- 通知数量信息和分页 -->
{% if total_pages > 1 %}
<div class="mt-3 d-flex justify-content-between align-items-center">
    <div>显示 {{ offset + 1 }} 到 {% if offset + per_page > total_count %}{{ total_count }}{% else %}{{ offset + per_page }}{% endif %} 条，共 {{ total_count }} 条</div>
    
    <nav>
        <div class="d-flex align-items-center">
            <ul class="pagination mb-0 me-3">
                <!-- 上一页按钮 -->
                <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
                    <a class="page-link page-nav-link" href="javascript:void(0);" data-page="{{ current_page-1 }}" {% if current_page == 1 %}disabled{% endif %}>上一页</a>
                </li>
                
                <!-- 生成页码按钮 -->
                {% set left_edge = 1 %}
                {% set right_edge = 1 %}
                {% set left_current = 2 %}
                {% set right_current = 2 %}
                
                {% if total_pages <= 7 %}
                    {% for page_num in range(1, total_pages + 1) %}
                        <li class="page-item {% if page_num == current_page %}active{% endif %}">
                            <a class="page-link page-nav-link" href="javascript:void(0);" data-page="{{ page_num }}">{{ page_num }}</a>
                        </li>
                    {% endfor %}
                {% else %}
                    <!-- 起始页码 -->
                    {% for page_num in range(1, left_edge + 1) %}
                        <li class="page-item {% if page_num == current_page %}active{% endif %}">
                            <a class="page-link page-nav-link" href="javascript:void(0);" data-page="{{ page_num }}">{{ page_num }}</a>
                        </li>
                    {% endfor %}
                    
                    <!-- 当前页周围的页码 -->
                    {% set start = current_page - left_current %}
                    {% set end = current_page + right_current %}
                    
                    {% if start <= left_edge + 1 %}
                        {% set start = left_edge + 1 %}
                    {% endif %}
                    
                    {% if end >= total_pages - right_edge %}
                        {% set end = total_pages - right_edge %}
                    {% endif %}
                    
                    {% if start > left_edge + 1 %}
                        <li class="page-item disabled">
                            <a class="page-link" href="javascript:void(0);">…</a>
                        </li>
                    {% endif %}
                    
                    {% for page_num in range(start, end + 1) %}
                        <li class="page-item {% if page_num == current_page %}active{% endif %}">
                            <a class="page-link page-nav-link" href="javascript:void(0);" data-page="{{ page_num }}">{{ page_num }}</a>
                        </li>
                    {% endfor %}
                    
                    {% if end < total_pages - right_edge %}
                        <li class="page-item disabled">
                            <a class="page-link" href="javascript:void(0);">…</a>
                        </li>
                    {% endif %}
                    
                    <!-- 结束页码 -->
                    {% for page_num in range(total_pages - right_edge + 1, total_pages + 1) %}
                        <li class="page-item {% if page_num == current_page %}active{% endif %}">
                            <a class="page-link page-nav-link" href="javascript:void(0);" data-page="{{ page_num }}">{{ page_num }}</a>
                        </li>
                    {% endfor %}
                {% endif %}
                
                <!-- 下一页按钮 -->
                <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
                    <a class="page-link page-nav-link" href="javascript:void(0);" data-page="{{ current_page+1 }}" {% if current_page == total_pages %}disabled{% endif %}>下一页</a>
                </li>
            </ul>
            
            <!-- 页码跳转控件 -->
            <div class="input-group" style="width: 180px;">
                <span class="input-group-text">跳至</span>
                <input type="number" id="pageJumpInput" class="form-control" min="1" max="{{ total_pages }}" placeholder="{{ current_page }}/{{ total_pages }}">
                <button class="btn btn-outline-primary" type="button" id="pageJumpBtn">
                    <i class="bi bi-arrow-right-circle"></i>
                </button>
            </div>
        </div>
    </nav>
</div>
{% endif %}

<!-- 搜索结果信息 -->
{% if search_params %}
<div class="mt-3 text-center text-muted">
    <p><i class="bi bi-filter-circle"></i> 共筛选出 <strong>{{ total_count }}</strong> 条符合条件的通知记录</p>
</div>
{% endif %}
{% else %}
<div class="text-center py-5">
    <i class="bi bi-bell-slash" style="font-size: 3rem; color: #adb5bd;"></i>
    <p class="mt-3 text-muted">没有找到符合条件的通知</p>
    {% if search_params %}
    <a href="{{ url_for('notifications.index') }}" class="btn btn-outline-primary mt-2">
        <i class="bi bi-arrow-repeat"></i> 显示所有通知
    </a>
    {% endif %}
</div>
{% endif %} 