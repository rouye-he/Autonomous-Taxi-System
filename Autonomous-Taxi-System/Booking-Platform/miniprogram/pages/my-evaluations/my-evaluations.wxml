<navigation-bar title="æˆ‘çš„è¯„ä»·" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<view class="container">
  <!-- å†…å®¹åŒºåŸŸå®¹å™¨ -->
  <view class="content-area">
    <!-- å¯¼èˆªæ  -->
    <view class="tab-navigation">
      <view 
        class="tab-navigation-item tab-pending-evaluation {{currentTab === 0 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="0"
      >
        å¾…è¯„ä»·
        <text class="tab-count">({{evaluationStats.pending}})</text>
      </view>
      <view 
        class="tab-navigation-item tab-completed-evaluation {{currentTab === 1 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="1"
      >
        å·²è¯„ä»·
        <text class="tab-count">({{evaluationStats.completed}})</text>
      </view>
    </view>

    <!-- è¯„ä»·åˆ—è¡¨ -->
    <view class="evaluation-list">
      <view 
        class="evaluation-item"
        wx:for="{{evaluations}}"
        wx:key="order_id"
      >
        <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
        <view class="evaluation-header">
          <view class="order-info">
            <text class="order-number">è®¢å•å·ï¼š{{item.order_number}}</text>
            <text class="order-time">{{formatTime(item.create_time)}}</text>
          </view>
          <view class="order-amount">Â¥{{item.amount}}</view>
        </view>

        <!-- è¡Œç¨‹ä¿¡æ¯ -->
        <view class="trip-info">
          <view class="location-item">
            <view class="location-dot start-dot"></view>
            <view class="location-text">
              <text class="location-label">èµ·ç‚¹</text>
              <text class="location-address">èµ·ç‚¹ä½ç½® <text class="location-coords" wx:if="{{item.pickup_location_x && item.pickup_location_y}}">({{item.pickup_location_x}}, {{item.pickup_location_y}})</text></text>
            </view>
          </view>
          <view class="location-item">
            <view class="location-dot end-dot"></view>
            <view class="location-text">
              <text class="location-label">ç»ˆç‚¹</text>
              <text class="location-address">ç»ˆç‚¹ä½ç½® <text class="location-coords" wx:if="{{item.dropoff_location_x && item.dropoff_location_y}}">({{item.dropoff_location_x}}, {{item.dropoff_location_y}})</text></text>
            </view>
          </view>
        </view>

        <!-- è¯„ä»·ä¿¡æ¯æˆ–æ“ä½œæŒ‰é’® -->
        <view class="evaluation-action">
          <!-- å¾…è¯„ä»·çŠ¶æ€ -->
          <view wx:if="{{currentTab === 0}}" class="pending-evaluation">
            <view class="evaluation-prompt">
              <text class="prompt-text">è¯·ä¸ºæœ¬æ¬¡è¡Œç¨‹è¯„ä»·</text>
              <text class="prompt-desc">æ‚¨çš„è¯„ä»·å¯¹æˆ‘ä»¬å¾ˆé‡è¦</text>
            </view>
            <button 
              class="evaluate-btn"
              bindtap="goToEvaluation"
              data-order-number="{{item.order_number}}"
            >
              ç«‹å³è¯„ä»·
            </button>
          </view>

          <!-- å·²è¯„ä»·çŠ¶æ€ -->
          <view wx:else class="completed-evaluation">
            <view class="rating-display">
              <view class="stars">
                <text 
                  class="star {{index < item.rating ? 'filled' : ''}}"
                  wx:for="{{[1,2,3,4,5]}}"
                  wx:key="*this"
                >
                  â˜…
                </text>
              </view>
              <text class="rating-text">{{item.rating}}æ˜Ÿ</text>
            </view>
            <view class="comment-preview" wx:if="{{item.comment}}">
              <text class="comment-text">{{item.comment}}</text>
            </view>
            <button 
              class="view-detail-btn"
              bindtap="viewEvaluationDetail"
              data-evaluation="{{item}}"
            >
              æŸ¥çœ‹è¯¦æƒ…
            </button>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€å¡ç‰‡ -->
      <view class="evaluation-item empty-card" wx:if="{{!loading && evaluations.length === 0}}">
        <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
        <view class="evaluation-header">
          <view class="order-info">
            <text class="order-number">ğŸ“ æš‚æ— {{currentTab === 0 ? 'å¾…è¯„ä»·' : 'å·²è¯„ä»·'}}è®¢å•</text>
            <text class="order-time">ç³»ç»Ÿæç¤º</text>
          </view>
          <view class="order-amount">ç³»ç»Ÿ</view>
        </view>

        <!-- è¡Œç¨‹ä¿¡æ¯ -->
        <view class="trip-info">
          <view class="location-item">
            <view class="location-dot start-dot"></view>
            <view class="location-text">
              <text class="location-label">æç¤º</text>
              <text class="location-address">{{currentTab === 0 ? 'å®Œæˆè®¢å•åå¯ä»¥è¿›è¡Œè¯„ä»·' : 'è¯„ä»·åçš„è®¢å•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ'}}</text>
            </view>
          </view>
          <view class="location-item">
            <view class="location-dot end-dot"></view>
            <view class="location-text">
              <text class="location-label">è¯´æ˜</text>
              <text class="location-address">æ‚¨çš„{{currentTab === 0 ? 'å¾…è¯„ä»·' : 'è¯„ä»·'}}è®°å½•å°†åœ¨æ­¤å¤„æ˜¾ç¤º</text>
            </view>
          </view>
        </view>

        <!-- è¯„ä»·ä¿¡æ¯ -->
        <view class="evaluation-action">
          <view class="completed-evaluation">
            <view class="rating-display">
              <view class="stars">
                <text class="star">â˜†</text>
                <text class="star">â˜†</text>
                <text class="star">â˜†</text>
                <text class="star">â˜†</text>
                <text class="star">â˜†</text>
              </view>
              <text class="rating-text">æš‚æ— è¯„ä»·</text>
            </view>
            <view class="comment-preview">
              <text class="comment-text">å¿«å»ä½“éªŒæˆ‘ä»¬çš„æ— äººé©¾é©¶å‡ºç§Ÿè½¦æœåŠ¡å§</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-text">åŠ è½½ä¸­...</view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore && !loading && evaluations.length > 0}}">
        <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view class="no-more" wx:if="{{!hasMore && evaluations.length > 0}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
  </view>
</view> 