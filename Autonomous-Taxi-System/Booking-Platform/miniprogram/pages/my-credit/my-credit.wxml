<navigation-bar title="æˆ‘çš„ä¿¡ç”¨" back="{{true}}" color="black" background="#FFF"></navigation-bar>

<view class="container">
  <!-- å†…å®¹åŒºåŸŸå®¹å™¨ -->
  <view class="content-area">
    <!-- ä¿¡ç”¨åˆ†å¡ç‰‡ -->
    <view class="credit-card">
      <view class="credit-header">
        <text class="credit-label">å½“å‰ä¿¡ç”¨åˆ†</text>
        <text class="credit-score">{{creditScore}}</text>
      </view>
      <view class="credit-level">
        <text class="level-label">ä¿¡ç”¨ç­‰çº§ï¼š</text>
        <text class="level-name">{{creditLevel.level_name}}</text>
     
      </view>
    </view>

    <!-- å¯¼èˆªæ  -->
    <view class="tab-navigation">
      <view 
        class="tab-navigation-item tab-levels {{activeTab === 0 ? 'active' : ''}}"
        bindtap="onTabChange"
        data-index="0"
      >
        ä¿¡ç”¨ç­‰çº§
        <text class="tab-count">({{allLevels.length}})</text>
      </view>
      <view 
        class="tab-navigation-item tab-rules {{activeTab === 1 ? 'active' : ''}}"
        bindtap="onTabChange"
        data-index="1"
      >
        å˜åŠ¨è§„åˆ™
        <text class="tab-count">({{rules.length}})</text>
      </view>
      <view 
        class="tab-navigation-item tab-logs {{activeTab === 2 ? 'active' : ''}}"
        bindtap="onTabChange"
        data-index="2"
      >
        å˜åŠ¨è®°å½•
        <text class="tab-count">({{logs.length}})</text>
      </view>
    </view>

    <!-- å†…å®¹åˆ—è¡¨ -->
    <view class="content-list">

      
      <!-- ä¿¡ç”¨ç­‰çº§å†…å®¹ -->
      <block wx:if="{{activeTab === 0}}">
        <view 
          class="level-item"
          wx:for="{{allLevels}}"
          wx:key="level_id"
        >
          <view class="level-header">
            <view class="level-info">
              <text class="level-title">{{item.level_name}}</text>
              <text class="level-range">{{item.min_score}} - {{item.max_score}}åˆ†</text>
              <text wx:if="{{item.level_id === creditLevel.level_id}}" class="current-badge">å½“å‰ç­‰çº§</text>
            </view>
          </view>
          <view class="level-content">
            <text class="section-title">ç­‰çº§æƒç›Š</text>
            <text class="benefits-text">{{item.benefits}}</text>
            <text class="section-title">ä½¿ç”¨é™åˆ¶</text>
            <text class="limitations-text">{{item.limitations}}</text>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€å¡ç‰‡ -->
        <view class="level-item empty-card" wx:if="{{!loading && allLevels.length === 0}}">
          <view class="level-header">
            <view class="level-info">
              <text class="level-title">ğŸ† æš‚æ— ä¿¡ç”¨ç­‰çº§æ•°æ®</text>
              <text class="level-range">ç³»ç»Ÿæç¤º</text>
            </view>
          </view>
          <view class="level-content">
            <text class="section-title">è¯´æ˜</text>
            <text class="benefits-text">ä¿¡ç”¨ç­‰çº§ä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
            <text class="section-title">æç¤º</text>
            <text class="limitations-text">è¯·è”ç³»ç®¡ç†å‘˜é…ç½®ä¿¡ç”¨ç­‰çº§æ•°æ®</text>
          </view>
        </view>
      </block>

      <!-- å˜åŠ¨è§„åˆ™å†…å®¹ -->
      <block wx:if="{{activeTab === 1}}">
        <view 
          class="rule-item"
          wx:for="{{rules}}"
          wx:key="rule_id"
        >
          <view class="rule-header">
            <view class="rule-info">
              <text class="rule-name">{{item.rule_name}}</text>
              <text class="rule-trigger">{{item.trigger_event}}</text>
            </view>
            <view class="rule-score {{item.rule_type === 'å¥–åŠ±' ? 'reward' : item.rule_type === 'æƒ©ç½š' ? 'penalty' : 'restore'}}">
              {{item.score_change > 0 ? '+' : ''}}{{item.score_change}}
            </view>
          </view>

          <view class="rule-details">
            <text class="rule-desc">{{item.description}}</text>
          </view>

          <view class="rule-meta">
            <text class="rule-type-label">ç±»å‹ï¼š{{item.rule_type}}</text>
            <text class="rule-status">{{item.is_active ? 'æ¿€æ´»' : 'åœç”¨'}}</text>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€å¡ç‰‡ -->
        <view class="rule-item empty-card" wx:if="{{!loading && rules.length === 0}}">
          <view class="rule-header">
            <view class="rule-info">
              <text class="rule-name">ğŸ“‹ æš‚æ— å˜åŠ¨è§„åˆ™</text>
              <text class="rule-trigger">ç³»ç»Ÿæç¤º</text>
            </view>
            <view class="rule-score empty-score">
              ç³»ç»Ÿ
            </view>
          </view>

          <view class="rule-details">
            <text class="rule-desc">ä¿¡ç”¨åˆ†å˜åŠ¨è§„åˆ™ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
          </view>

          <view class="rule-meta">
            <text class="rule-type-label">ç±»å‹ï¼šç³»ç»Ÿæç¤º</text>
            <text class="rule-status">è¯·è”ç³»ç®¡ç†å‘˜é…ç½®è§„åˆ™</text>
          </view>
        </view>
      </block>

      <!-- å˜åŠ¨è®°å½•å†…å®¹ -->
      <block wx:if="{{activeTab === 2}}">
        <view 
          class="log-item"
          wx:for="{{logs}}"
          wx:key="log_id"
        >
          <view class="log-header">
            <view class="log-info">
              <text class="log-type">{{item.change_type}}</text>
              <text class="log-time">{{formatTime(item.created_at)}}</text>
            </view>
            <view class="log-score {{item.change_amount > 0 ? 'positive' : 'negative'}}">
              {{item.change_amount > 0 ? '+' : ''}}{{item.change_amount}}
            </view>
          </view>

          <view class="log-details">
            <text class="log-reason">{{item.reason}}</text>
          </view>

          <view class="log-meta">
            <text class="score-range">{{item.credit_before}} â†’ {{item.credit_after}}</text>
            <text class="log-operator">{{item.operator || 'ç³»ç»Ÿ'}}</text>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€å¡ç‰‡ -->
        <view class="log-item empty-card" wx:if="{{!loading && logs.length === 0}}">
          <view class="log-header">
            <view class="log-info">
              <text class="log-type">ğŸ“Š æš‚æ— å˜åŠ¨è®°å½•</text>
              <text class="log-time">ç³»ç»Ÿæç¤º</text>
            </view>
            <view class="log-score empty-score">
              ç³»ç»Ÿ
            </view>
          </view>

          <view class="log-details">
            <text class="log-reason">ä¿¡ç”¨åˆ†å˜åŠ¨è®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ</text>
          </view>

          <view class="log-meta">
            <text class="score-range">æš‚æ— è®°å½•</text>
            <text class="log-operator">ç³»ç»Ÿ</text>
          </view>
        </view>
      </block>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-text">åŠ è½½ä¸­...</view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore && !loading && (allLevels.length > 0 || rules.length > 0 || logs.length > 0)}}">
        <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view class="no-more" wx:if="{{!hasMore && (allLevels.length > 0 || rules.length > 0 || logs.length > 0)}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
  </view>
</view> 