<view class="container">
  <!-- å¤´éƒ¨å¯¼èˆª -->
  <view class="header">
    <view class="title">å¯¹è¯å†å²</view>
    <view class="date-filter">
      <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
        <view class="date-picker">
          <text>{{selectedDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
          <text class="icon">ğŸ“…</text>
        </view>
      </picker>
      <button class="clear-filter" bindtap="clearDateFilter" wx:if="{{selectedDate}}">æ¸…é™¤æ—¥æœŸç­›é€‰</button>
    </view>
  </view>

  <!-- å¯ç”¨æ—¥æœŸæç¤º -->
  <view class="available-dates" wx:if="{{availableDates.length > 0}}">
    <text class="label">æœ‰å¯¹è¯è®°å½•çš„æ—¥æœŸï¼š</text>
    <scroll-view class="dates-scroll" scroll-x>
      <view class="date-item {{item === selectedDate ? 'active' : ''}}" 
            wx:for="{{availableDates}}" 
            wx:key="*this"
            bindtap="selectDate"
            data-date="{{item}}">
        {{item}}
      </view>
    </scroll-view>
  </view>

  <!-- å¯¹è¯è®°å½•åˆ—è¡¨ -->
  <scroll-view class="chat-list" scroll-y scroll-top="{{scrollTop}}" scroll-into-view="{{toView}}">
    <view class="empty-state" wx:if="{{chatHistory.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ’¬</text>
      <text class="empty-text">{{selectedDate ? 'è¯¥æ—¥æœŸæš‚æ— å¯¹è¯è®°å½•' : 'æš‚æ— å¯¹è¯è®°å½•'}}</text>
    </view>
    
    <view class="date-group" wx:if="{{chatHistory.length > 0}}">
      <view class="date-header" wx:if="{{selectedDate}}">{{selectedDate}}</view>
      
      <view class="message-item {{item.role}}" 
            wx:for="{{chatHistory}}" 
            wx:key="id"
            id="msg-{{item.id}}">
        
        <!-- åŠ©æ‰‹æ¶ˆæ¯ -->
        <view class="message-wrapper" wx:if="{{item.role === 'assistant'}}">
          <view class="message-avatar">
            <image class="avatar" src="{{robotAvatar}}" mode="aspectFill" 
                   binderror="onRobotAvatarError" wx:if="{{showRobotImage}}" />
            <text class="icon" wx:else>ğŸ¤–</text>
          </view>
          <view class="message-content">
            <view class="message-bubble">{{item.message}}</view>
            <view class="message-time">{{item.time}}</view>
          </view>
        </view>

        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <view class="message-wrapper" wx:else>
          <view class="message-content">
            <view class="message-bubble">{{item.message}}</view>
            <view class="message-time">{{item.time}}</view>
          </view>
          <view class="message-avatar">
            <image class="avatar" src="{{userAvatar}}" mode="aspectFill" 
                   binderror="onUserAvatarError" wx:if="{{showUserImage}}" />
            <text class="icon" wx:else>ğŸ‘¤</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && !loading}}">
      <button class="load-btn" bindtap="loadMore">åŠ è½½æ›´å¤š</button>
    </view>
    
    <view class="loading" wx:if="{{loading}}">
      <text class="loading-icon">â³</text>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </scroll-view>
</view> 