<navigation-bar title="æˆ‘çš„é’±åŒ…" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<view class="container">
  <!-- å†…å®¹åŒºåŸŸå®¹å™¨ -->
  <view class="content-area">
    <!-- ä½™é¢å¡ç‰‡ -->
    <view class="balance-card">
      <view class="balance-header">
        <text class="balance-label">è´¦æˆ·ä½™é¢</text>
        <text class="balance-amount">Â¥{{userBalance}}</text>
      </view>
      <view class="balance-actions">
        <button class="action-btn recharge-btn" bindtap="goToRecharge">
          <text class="btn-icon">ğŸ’°</text>
          <text class="btn-text">å……å€¼</text>
        </button>
        <button class="action-btn withdraw-btn" bindtap="goToWithdraw">
          <text class="btn-icon">ğŸ’³</text>
          <text class="btn-text">æç°</text>
        </button>
      </view>
    </view>

    <!-- å¯¼èˆªæ  -->
    <view class="tab-navigation">
      <view 
        class="tab-navigation-item tab-income {{currentTab === 0 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="0"
      >
        æ”¶å…¥è®°å½•
        <text class="tab-count">({{transactionStats.income}})</text>
      </view>
      <view 
        class="tab-navigation-item tab-expense {{currentTab === 1 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="1"
      >
        æ¶ˆè´¹è®°å½•
        <text class="tab-count">({{transactionStats.expense}})</text>
      </view>
      <view 
        class="tab-navigation-item tab-all {{currentTab === 2 ? 'active' : ''}}"
        bindtap="switchTab"
        data-index="2"
      >
        å…¨éƒ¨è®°å½•
        <text class="tab-count">({{transactionStats.total}})</text>
      </view>
    </view>

    <!-- äº¤æ˜“è®°å½•åˆ—è¡¨ -->
    <view class="transaction-list">
      <view 
        class="transaction-item"
        wx:for="{{transactions}}"
        wx:key="id"
      >
        <view class="transaction-main">
          <view class="transaction-info">
            <view class="transaction-type">{{item.type}}</view>
            <view class="transaction-time">{{item.created_at}}</view>
          </view>
          <view class="transaction-amount {{item.amount_type === 'income' ? 'income' : 'expense'}}">
            {{item.amount_type === 'income' ? '+' : '-'}}Â¥{{item.amount}}
          </view>
        </view>

        <!-- äº¤æ˜“è¯¦æƒ… -->
 

        <!-- è®¢å•è¯¦ç»†ä¿¡æ¯ - ä»…è½¦è´¹ç±»å‹æ˜¾ç¤º -->
        <view class="transaction-order-details" wx:if="{{item.type === 'è½¦è´¹' && (item.distance || item.payment_method || item.pickup_coords || item.dropoff_coords)}}">
          <view class="order-detail-row" wx:if="{{item.distance}}">
            <text class="detail-label">è¡Œç¨‹è·ç¦»:</text>
            <text class="detail-value">{{item.distance}}km</text>
          </view>
          <view class="order-detail-row" wx:if="{{item.payment_method}}">
            <text class="detail-label">æ”¯ä»˜æ–¹å¼:</text>
            <text class="detail-value">{{item.payment_method}}</text>
          </view>
     
          <view class="order-detail-row" wx:if="{{item.coupon_info}}">
            <text class="detail-label">ä¼˜æƒ ä¿¡æ¯:</text>
            <text class="detail-value">{{item.coupon_info}}</text>
          </view>
          <view class="order-detail-row" wx:if="{{item.pickup_coords}}">
            <text class="detail-label">èµ·ç‚¹åæ ‡:</text>
            <text class="detail-value">{{item.pickup_coords}}</text>
          </view>
          <view class="order-detail-row" wx:if="{{item.dropoff_coords}}">
            <text class="detail-label">ç»ˆç‚¹åæ ‡:</text>
            <text class="detail-value">{{item.dropoff_coords}}</text>
          </view>
        </view>

        <!-- å…³è”è®¢å•ä¿¡æ¯ -->
        <view class="transaction-order" wx:if="{{item.order_id}}">
          <text class="order-label">å…³è”è®¢å•ï¼š</text>
          <text class="order-number">{{item.order_id}}</text>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€å¡ç‰‡ -->
      <view class="transaction-item empty-card" wx:if="{{!loading && transactions.length === 0}}">
        <!-- äº¤æ˜“å¤´éƒ¨ä¿¡æ¯ -->
        <view class="transaction-header">
          <view class="transaction-info">
            <text class="transaction-type">ğŸ’° æš‚æ— {{currentTab === 0 ? 'æ”¶å…¥' : currentTab === 1 ? 'æ¶ˆè´¹' : 'äº¤æ˜“'}}è®°å½•</text>
            <text class="transaction-time">ç³»ç»Ÿæç¤º</text>
          </view>
          <view class="transaction-amount empty-amount">
            ç³»ç»Ÿ
          </view>
        </view>

        <!-- äº¤æ˜“è¯¦æƒ… -->
        <view class="transaction-details">
          <text class="transaction-desc">{{currentTab === 0 ? 'æ”¯å‡ºè¡¨ä¸­çš„ç›¸å…³è®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ' : currentTab === 1 ? 'æ”¶å…¥è¡¨ä¸­çš„ç›¸å…³è®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ' : 'æ‰€æœ‰äº¤æ˜“è®°å½•ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ'}}</text>
        </view>

        <!-- å…³è”è®¢å•ä¿¡æ¯ -->
        <view class="transaction-order">
          <text class="order-label">æç¤ºï¼š</text>
          <text class="order-number">å¿«å»ä½¿ç”¨å……å€¼å’Œæç°åŠŸèƒ½å§</text>
        </view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{loading}}">
        <view class="loading-text">åŠ è½½ä¸­...</view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{hasMore && !loading && transactions.length > 0}}">
        <text class="load-more-text">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
      </view>

      <!-- æ²¡æœ‰æ›´å¤š -->
      <view class="no-more" wx:if="{{!hasMore && transactions.length > 0}}">
        <text class="no-more-text">æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
  </view>
</view> 