<navigation-bar title="个人信息" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<view class="profile-container">
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 刷新按钮 -->
  <view class="refresh-button" bindtap="refreshUserInfo">
    <text class="refresh-icon">↻</text>
  </view>

  <!-- 用户信息卡片，去掉头像 -->
  <view class="user-card" wx:if="{{!isLoading}}">
    <view class="info-container">
      <view class="username">{{userInfo.username || '未设置用户名'}}</view>
      <view class="credit-score">
        信用分: {{userInfo.credit_score || 100}}
        <text class="badge {{creditLevel === '极低信用' ? 'badge-danger' : creditLevel === '低信用' ? 'badge-warning' : ''}}">{{creditLevel}}</text>
      </view>
    </view>
  </view>
  
  <!-- 统计数据 -->
  <view class="stats-container" wx:if="{{!isLoading}}">
    <view class="stat-item">
      <text class="stat-value">{{userInfo.total_orders || 0}}</text>
      <text class="stat-label">订单数</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{userInfo.balance || '0.00'}}</text>
      <text class="stat-label">余额</text>
    </view>
    <view class="stat-item">
      <text class="stat-value">{{userInfo.coupon_count || 0}}</text>
      <text class="stat-label">优惠券</text>
    </view>
  </view>
  
  <view class="section-title" wx:if="{{!isLoading}}">基本信息</view>
  <view class="info-list" wx:if="{{!isLoading}}">
    <view class="info-item">
      <text class="info-label">真实姓名</text>
      <text class="info-value">{{userInfo.real_name || '未认证'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">手机号码</text>
      <text class="info-value">{{userInfo.phone || '未绑定'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">电子邮箱</text>
      <text class="info-value">{{userInfo.email || '未设置'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">性别</text>
      <text class="info-value">{{userInfo.gender || '未设置'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">出生日期</text>
      <text class="info-value">{{userInfo.birth_date || '未设置'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">注册城市</text>
      <text class="info-value">{{userInfo.registration_city || '未获取'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">注册渠道</text>
      <text class="info-value">{{userInfo.registration_channel || '未获取'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">注册时间</text>
      <text class="info-value">{{userInfo.registration_time || '未获取'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">上次登录</text>
      <text class="info-value">{{userInfo.last_login_time || '未获取'}}</text>
    </view>
  </view>
  
  <view class="section-title" wx:if="{{!isLoading && userInfo.tags}}">用户标签</view>
  <view class="tags-container" wx:if="{{!isLoading && userInfo.tags}}">
    <text class="tag" wx:for="{{tagsArray}}" wx:key="index">{{item}}</text>
  </view>
  
  <view class="action-button" wx:if="{{!isLoading}}">
    <button class="unified-btn" bindtap="handleEditProfile">编辑资料</button>
  </view>
  
  <view class="section-title" wx:if="{{!isLoading}}">安全设置</view>
  <view class="info-list" wx:if="{{!isLoading}}">
    <view class="info-item" bindtap="goToChangePwd">
      <text class="info-label">修改密码</text>
      <text class="arrow">></text>
    </view>
  </view>
  
  <view class="action-button" wx:if="{{!isLoading}}">
    <button class="unified-btn danger" bindtap="handleLogout">退出登录</button>
  </view>
</view> 