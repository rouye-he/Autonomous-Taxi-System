<navigation-bar title="æˆ‘çš„ä¼˜æƒ åˆ¸" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<view class="container">
  <!-- è´­ä¹°å…¥å£ -->
  <view class="shop-entrance" bindtap="goToCouponShop">
    <view class="shop-icon">ğŸ›’</view>
    <view class="shop-text">
      <text class="shop-title">ä¼˜æƒ åˆ¸å•†åŸ</text>
      <text class="shop-desc">è´­ä¹°æ›´å¤šä¼˜æƒ åˆ¸åŒ…</text>
    </view>
    <view class="shop-arrow">></view>
  </view>
  
  <view class="tab-header">
    <view class="tab {{currentTab === 0 ? 'active' : ''}}" bindtap="switchTab" data-index="0">
      å¯ç”¨
      <text class="tab-count" wx:if="{{couponStats.available > 0}}">({{couponStats.available}})</text>
    </view>
    <view class="tab {{currentTab === 1 ? 'active' : ''}}" bindtap="switchTab" data-index="1">
      å·²ä½¿ç”¨
      <text class="tab-count" wx:if="{{couponStats.used > 0}}">({{couponStats.used}})</text>
    </view>
    <view class="tab {{currentTab === 2 ? 'active' : ''}}" bindtap="switchTab" data-index="2">
      å·²è¿‡æœŸ
      <text class="tab-count" wx:if="{{couponStats.expired > 0}}">({{couponStats.expired}})</text>
    </view>
  </view>
  
  <!-- å›ºå®šçš„å†…å®¹åŒºåŸŸ -->
  <view class="content-area">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{loading}}">
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>
    
    <!-- ä¼˜æƒ åˆ¸åˆ—è¡¨ -->
    <view class="coupon-list" wx:elif="{{coupons.length > 0}}">
      <!-- ç§ç±»ç»Ÿè®¡ä¿¡æ¯ - æŒ‰ç§ç±»å’Œè¿‡æœŸæ—¶é—´åˆ†ç»„ -->
      <view class="stats-container" wx:if="{{currentTab === 0 && couponStats.availableByType.length > 0}}">
        <view class="stats-title">ğŸ“Š å¯ç”¨ä¼˜æƒ åˆ¸ç»Ÿè®¡ï¼ˆæŒ‰ç§ç±»å’Œè¿‡æœŸæ—¶é—´åˆ†ç»„ï¼‰</view>
        <view class="stats-item" wx:for="{{couponStats.availableByType}}" wx:key="index">
          <view class="stats-type-info">
            <text class="stats-type">{{item.typeName}}</text>
         
          </view>
          <text class="stats-count">{{item.count}}å¼ </text>
        </view>
      </view>
      
      <view class="stats-container" wx:if="{{currentTab === 1 && couponStats.usedByType.length > 0}}">
        <view class="stats-title">ğŸ“Š å·²ä½¿ç”¨ä¼˜æƒ åˆ¸ç»Ÿè®¡</view>
        <view class="stats-item" wx:for="{{couponStats.usedByType}}" wx:key="index">
          <view class="stats-type-info">
            <text class="stats-type">{{item.typeName}}</text>
 
          </view>
          <text class="stats-count">{{item.count}}å¼ </text>
        </view>
      </view>
      
      <view class="stats-container" wx:if="{{currentTab === 2 && couponStats.expiredByType.length > 0}}">
        <view class="stats-title">ğŸ“Š å·²è¿‡æœŸä¼˜æƒ åˆ¸ç»Ÿè®¡</view>
        <view class="stats-item" wx:for="{{couponStats.expiredByType}}" wx:key="index">
          <view class="stats-type-info">
            <text class="stats-type">{{item.typeName}}</text>
            <text class="stats-expire">è¿‡æœŸ: {{item.expireDate}}</text>
          </view>
          <text class="stats-count">{{item.count}}å¼ </text>
        </view>
      </view>
      
      <view class="coupon-item {{item.status !== 'æœªä½¿ç”¨' ? 'coupon-disabled' : ''}}" wx:for="{{coupons}}" wx:key="coupon_id">
        <view class="coupon-left">
          <view class="coupon-value">
            <text class="value-unit" wx:if="{{item.coupon_category === 'æ»¡å‡åˆ¸'}}">Â¥</text>
            <text class="value-number" wx:if="{{item.coupon_category === 'æ»¡å‡åˆ¸'}}">{{item.value}}</text>
            <text class="value-number" wx:else>{{item.value * 10}}æŠ˜</text>
          </view>
          <view class="coupon-limit">{{item.min_amount == 0 ? 'æ— é—¨æ§›' : 'æ»¡' + item.min_amount + 'å…ƒå¯ç”¨'}}</view>
        </view>
        <view class="coupon-right">
          <view class="coupon-name">{{item.type_name}}</view>
          <view class="coupon-desc">{{item.description}}</view>
          <view class="coupon-time">æœ‰æ•ˆæœŸ: {{item.validity_start_date}} - {{item.validity_end_date}}</view>
          <view class="coupon-status {{item.status !== 'æœªä½¿ç”¨' ? 'status-disabled' : ''}}">{{item.status}}</view>
        </view>
        <view class="coupon-btn" wx:if="{{item.status === 'æœªä½¿ç”¨'}}" bindtap="useCoupon" data-id="{{item.coupon_id}}">ç«‹å³ä½¿ç”¨</view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€å¡ç‰‡ -->
    <view class="coupon-item empty-card" wx:else>
      <view class="coupon-left">
        <view class="coupon-value">
          <text class="value-number">ğŸ«</text>
        </view>
        <view class="coupon-limit">æš‚æ— ä¼˜æƒ åˆ¸</view>
      </view>
      <view class="coupon-right">
        <view class="coupon-name">{{currentTab === 0 ? 'æš‚æ— å¯ç”¨ä¼˜æƒ åˆ¸' : currentTab === 1 ? 'æš‚æ— å·²ä½¿ç”¨ä¼˜æƒ åˆ¸' : 'æš‚æ— è¿‡æœŸä¼˜æƒ åˆ¸'}}</view>
        <view class="coupon-desc">{{currentTab === 0 ? 'å¿«å»ä¼˜æƒ åˆ¸å•†åŸè´­ä¹°ä¼˜æƒ åˆ¸åŒ…å§' : currentTab === 1 ? 'ä½¿ç”¨è¿‡çš„ä¼˜æƒ åˆ¸ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ' : 'è¿‡æœŸçš„ä¼˜æƒ åˆ¸ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ'}}</view>
        <view class="coupon-time">æç¤º: ç‚¹å‡»ä¸Šæ–¹ä¼˜æƒ åˆ¸å•†åŸè´­ä¹°æ›´å¤šä¼˜æƒ åˆ¸</view>
        <view class="coupon-status">ç³»ç»Ÿæç¤º</view>
      </view>
      <view class="coupon-btn empty-btn" wx:if="{{currentTab === 0}}" bindtap="goToCouponShop">å»è´­ä¹°</view>
    </view>
  </view>
</view> 