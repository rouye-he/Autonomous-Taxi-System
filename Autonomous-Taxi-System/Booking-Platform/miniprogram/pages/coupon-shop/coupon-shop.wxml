<navigation-bar title="ä¼˜æƒ åˆ¸å•†åŸ" back="{{true}}" color="black" background="#FFF"></navigation-bar>
<view class="profile-container">
  <!-- å¥—é¤åˆ—è¡¨ -->
  <view class="package-list" wx:if="{{packages.length > 0}}">
    <view class="package-item" wx:for="{{packages}}" wx:key="id" bindtap="onPackageClick" data-package="{{item}}">
      <!-- å¥—é¤å¤´éƒ¨ -->
      <view class="package-header">
        <view class="package-name">{{item.name}}</view>
        <view class="package-discount" wx:if="{{item.discount > 0}}">{{item.discount}}æŠ˜</view>
      </view>
      
      <!-- å¥—é¤æè¿° -->
      <view class="package-desc">{{item.description}}</view>
      
      <!-- ä¼˜æƒ åˆ¸è¯¦æƒ… -->
      <view class="coupon-details">
        <view class="detail-item" wx:for="{{item.coupon_details}}" wx:key="type_name" wx:for-item="coupon">
          <view class="coupon-badge">
            <text class="coupon-value">{{coupon.category === 'æŠ˜æ‰£åˆ¸' ? (coupon.value * 10) + 'æŠ˜' : 'Â¥' + coupon.value}}</text>
            <text class="coupon-count">Ã—{{coupon.count}}</text>
          </view>
          <view class="coupon-info">
            <text class="coupon-name">{{coupon.type_name}}</text>
            <text class="coupon-limit">{{coupon.min_amount == 0 ? 'æ— é—¨æ§›' : 'æ»¡' + coupon.min_amount + 'å…ƒå¯ç”¨'}}</text>
          </view>
        </view>
      </view>
      
      <!-- ä»·æ ¼å’Œè´­ä¹° -->
      <view class="package-footer">
        <view class="price-section">
          <text class="current-price">Â¥{{item.price}}</text>
          <text class="original-price" wx:if="{{item.original_price > item.price}}">Â¥{{item.original_price}}</text>
        </view>
        <view class="package-info">
          <text class="validity">æœ‰æ•ˆæœŸ{{item.validity_days}}å¤©</text>
          <text class="sale-count">å·²å”®{{item.sale_count}}ä»½</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:else>
    <view class="empty-icon">ğŸ«</view>
    <text class="empty-text">æš‚æ— ä¼˜æƒ åˆ¸åŒ…</text>
  </view>
  
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- è´­ä¹°ç¡®è®¤å¼¹çª— -->
<view class="modal-overlay" wx:if="{{showPurchaseModal}}" bindtap="onModalClose">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤è´­ä¹°</text>
      <text class="modal-close" bindtap="onModalClose">Ã—</text>
    </view>
    
    <view class="modal-body">
      <view class="selected-package">
        <view class="package-name">{{selectedPackage.name}}</view>
        <view class="package-price">Â¥{{selectedPackage.price}}</view>
      </view>
      
      <view class="payment-section">
        <view class="section-title">æ”¯ä»˜æ–¹å¼</view>
        <view class="payment-options">
          <view class="payment-option {{paymentMethod === 'ä½™é¢æ”¯ä»˜' ? 'selected' : ''}}" bindtap="onPaymentMethodChange" data-method="ä½™é¢æ”¯ä»˜">
            <text class="payment-name">ä½™é¢æ”¯ä»˜</text>
            <text class="payment-balance">ä½™é¢ï¼šÂ¥{{userBalance}}</text>
          </view>
          <view class="payment-option {{paymentMethod === 'å¾®ä¿¡æ”¯ä»˜' ? 'selected' : ''}}" bindtap="onPaymentMethodChange" data-method="å¾®ä¿¡æ”¯ä»˜">
            <text class="payment-name">å¾®ä¿¡æ”¯ä»˜</text>
          </view>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="onModalClose" hover-class="button-hover">å–æ¶ˆ</button>
      <button class="confirm-btn {{purchasing ? 'disabled' : ''}}" bindtap="onConfirmPurchase" disabled="{{purchasing}}" hover-class="button-hover">
        {{purchasing ? 'è´­ä¹°ä¸­...' : 'ç¡®è®¤è´­ä¹°'}}
      </button>
    </view>
  </view>
</view> 